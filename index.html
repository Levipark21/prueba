<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Visor FBX en primera persona</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #instrucciones {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: white; font-size: 20px; background: rgba(0,0,0,0.6);
      padding: 20px; border-radius: 10px; cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="instrucciones">Haz click para entrar al visor<br>(Mover rat√≥n + WASD)</div>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.150/build/three.module.js";
    import { FBXLoader } from "https://cdn.jsdelivr.net/npm/three@0.150/examples/jsm/loaders/FBXLoader.js";
    import { PointerLockControls } from "https://cdn.jsdelivr.net/npm/three@0.150/examples/jsm/controls/PointerLockControls.js";

    let camera, scene, renderer, controls;
    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const keys = {};

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x202020);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 1.6, 0); // altura "ojos"

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // luz
      const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
      hemi.position.set(0, 200, 0);
      scene.add(hemi);

      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(5, 10, 7.5);
      scene.add(dirLight);

      // üîπ CAMBIA ESTA URL por la de tu archivo FBX (raw en GitHub)
      const fbxURL = "https://raw.githubusercontent.com/Levipark21/prueba/main/cerdito.fbx";

      const loader = new FBXLoader();
      loader.load(fbxURL, (fbx) => {
        fbx.scale.set(0.01, 0.01, 0.01); // ajusta escala si es muy grande
        scene.add(fbx);
      });

      // controles primera persona
      controls = new PointerLockControls(camera, document.body);

      const instrucciones = document.getElementById("instrucciones");
      instrucciones.addEventListener("click", () => {
        controls.lock();
      });

      controls.addEventListener("lock", () => {
        instrucciones.style.display = "none";
      });
      controls.addEventListener("unlock", () => {
        instrucciones.style.display = "block";
      });

      scene.add(controls.getObject());

      // teclado
      document.addEventListener("keydown", (e) => keys[e.code] = true);
      document.addEventListener("keyup", (e) => keys[e.code] = false);

      window.addEventListener("resize", onWindowResize);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      requestAnimationFrame(animate);

      if (controls.isLocked === true) {
        const delta = 0.05; // velocidad
        velocity.set(0, 0, 0);

        if (keys["KeyW"]) velocity.z -= delta;
        if (keys["KeyS"]) velocity.z += delta;
        if (keys["KeyA"]) velocity.x -= delta;
        if (keys["KeyD"]) velocity.x += delta;

        direction.copy(velocity).applyQuaternion(camera.quaternion);
        controls.moveRight(direction.x);
        controls.moveForward(direction.z);
      }

      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
